<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>跨域资源访问 | ChuckLin's Blog</title><meta name=description content="Love and Peace"><meta name=author content><link rel=apple-touch-icon sizes=180x180 href=https://www.chucklin.net/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://www.chucklin.net/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.chucklin.net/favicon-16x16.png><link rel=manifest href=https://www.chucklin.net/site.webmanifest><link rel=mask-icon href=https://www.chucklin.net/safari-pinned-tab.svg color=#00416a><meta name=msapplication-TileColor content="#00aba9"><meta name=theme-color content="#ffffff"><link rel=me href=mailto:mikumiku.lch@hotmail.com><link rel=me href=https://github.com/chuck1in><link rel=authorization_endpoint href=https://indieauth.com/auth><link rel=token_endpoint href=https://tokens.indieauth.com/token><link rel=stylesheet href=https://www.chucklin.net/css/fonts.css><link rel=stylesheet href=https://www.chucklin.net/css/style.css><link rel=stylesheet href=https://www.chucklin.net/css/custom.css><meta name=viewport content="width=device-width,initial-scale=1"></head><body><div id=sitelogo><a class=glyph alt=Home href=https://www.chucklin.net/><img src=https://www.chucklin.net/images/site-logo.svg alt="Site Logo" height=64px width=64px></a></div><header><nav><div id=page-nav><div class=page-nav-item><a href=https://www.chucklin.net/>Home</a></div><div class=page-nav-item><a href=/about/me><span>About</span></a></div><div class=page-nav-item><a href=/tags><span>Tag</span></a></div></div></nav></header><div id=content><article class=h-entry><header><h1 class="post-title p-name">跨域资源访问</h1><p class=post-date>Posted on
<time class=dt-published datetime=2020-02-19T09:52:00+08:00>19 February, 2020 at 09:52 +0800</time> by <a href=https://www.chucklin.net/ class="p-author h-card" rel=author>Chuck Lin</a></p></header><section class="content e-content"><h2 id=跨域>跨域</h2><p>当一个资源请求一个其它域名或者另外一个端口的资源时会产生一个跨域 HTTP 请求(cross-origin HTTP request)。比如说，http://domaina.example 的某 HTML 页面通过 img 的 src 请求 <a href=http://domainb.foo/image.jpg>http://domainb.foo/image.jpg</a>。在当今的 Web 开发中，许多页面都会从另外一个站点加载各类资源（包括 CSS、图片、JavaScript 脚本以及其它类资源）。</p><p>针对不同的来源的各类资源的交互，各大浏览器往往遵循「同源策略」，对交互进行处理。</p><h2 id=同源策略>同源策略</h2><p>同源策略限制从一个源加载的文档或脚本如何与来自另一个源的资源进行交互。如果协议，端口（如果指定了一个）和主机对于两个页面是相同的，则两个页面具有相同的源。
下表给出了相对 <a href=http://store.company.com/dir/page.html>http://store.company.com/dir/page.html</a> 同源检测的示例:</p><table><thead><tr><th>URL</th><th style=text-align:right>结果</th><th style=text-align:center>原因</th></tr></thead><tbody><tr><td><a href=http://store.company.com/dir2/other.html>http://store.company.com/dir2/other.html</a></td><td style=text-align:right>成功</td><td style=text-align:center>dir2/other.html</td></tr><tr><td><a href=http://store.company.com/dir/inner/another.html>http://store.company.com/dir/inner/another.html</a></td><td style=text-align:right>成功</td><td style=text-align:center>dir/inner/another.html</td></tr><tr><td><a href=https://store.company.com/secure.html>https://store.company.com/secure.html</a></td><td style=text-align:right>失败</td><td style=text-align:center>不同的协议 ( https )</td></tr><tr><td><a href=http://store.company.com:81/dir/etc.html>http://store.company.com:81/dir/etc.html</a></td><td style=text-align:right>失败</td><td style=text-align:center>不同的端口 ( 81 )</td></tr><tr><td><a href=http://news.company.com/dir/other.html>http://news.company.com/dir/other.html</a></td><td style=text-align:right>失败</td><td style=text-align:center>不同的主机（主机）</td></tr></tbody></table><h3 id=常见跨源网络访问>常见跨源网络访问</h3><p>同源策略控制了不同源之间的交互，例如在使用 XMLHttpRequest 或 img 标签时则会受到同源策略的约束。交互通常分为三类：</p><ul><li>通常允许进行跨域写操作（Cross-origin writes）。例如链接（links），重定向以及表单提交。特定少数的 HTTP 请求需要添加 preflight。</li><li>通常允许跨域资源嵌入（Cross-origin embedding）。之后下面会举例说明。</li><li>通常不允许跨域读操作（Cross-origin reads）。但常可以通过内嵌资源来巧妙的进行读取访问。例如可以读取嵌入图片的高度和宽度，调用内嵌脚本的方法，或 availability of an embedded resource.</li></ul><h3 id=常见跨域资源嵌入示例>常见跨域资源嵌入示例</h3><ul><li><code>&lt;script src="...">&lt;/script></code>标签嵌入跨域脚本。语法错误信息只能在同源脚本中捕捉到。</li><li><code>&lt;img></code>嵌入图片。支持的图片格式包括 PNG,JPEG,GIF,BMP,SVG,&mldr;</li><li><code>&lt;video></code> 和 <code>&lt;audio></code>嵌入多媒体资源。</li></ul><p>可见，在通常情况下使用 XMLHttpRequest 的跨域读取操作将会受到限制，而<code>&lt;img></code>的资源嵌入操作则可以执行。不过，若当前环境希望用户能够自由请求服务器，不受同源策略限制应该怎么办？这样的问题，就需要引入 CORS。</p><h2 id=cors>CORS</h2><p>是一种跨域资源共享（Cross-origin resource sharing）的解决方案。它定义了一种浏览器和服务器交互的方式来确定是否允许跨域请求。
它是一个妥协，有更大的灵活性，但比起简单地允许所有这些的要求来说更加安全。简言之，CORS 就是为了让 AJAX 可以实现可控的跨域访问而生的。通常我们采用配置 http response header 的方式就可以启用 CORS：<code>Access–Control-Allow-Origin: *</code></p><h3 id=启用-cors-带来的安全隐患>启用 CORS 带来的安全隐患</h3><ul><li><p>恶意跨域请求
即便页面只允许来自某个信任网站的请求，但是它也会收到大量来自其他域的跨域请求。.这些请求有时可能会被用于执行应用层面的 DDOS 攻击，并不应该被应用来处理。</p></li><li><p>假定一个内部站点开启了 CORS，如果内部网络的用户访问了恶意网站，恶意网站可以通过 CORS（跨域请求）来获取到内部站点的内容。</p></li></ul><h2 id=总结>总结</h2><p>属于不同源的资源之间互相请求时会产生「跨域访问」的问题。各大浏览器通常基于「同源策略」对跨域访问进行处理。而 CORS 则提供了跨域资源共享的解决方案，使的同源策略能够通过 CORS 变得更加的灵活，以满足不同场景的需要。</p></section><footer><a class="permalink u-url" href=https://www.chucklin.net/post/cors/>🔗</a><hr class=post-underline><p class=post-tag>Tags for this post:
<a href=https://www.chucklin.net/tags/security class="post-tag p-category">security</a></p></footer></article></div><div class=h-card><img class=u-photo src=https://www.chucklin.net/images/avator.jpg><div class=card-content><h2 class=card-name><a class="p-name u-url" href=https://www.chucklin.net/ rel=me>Chuck Lin</a></h2><p class=card-subhead><span class=p-locality>Chengdu</span>,
<span class=p-country-name>China</span><br><a class=u-email href=mailto:mikumiku.lch@hotmail.com>Email me</a></p></div><p class=p-note>👋很高兴见到你。我从事开发工作10年、持续写作4年；现在的身份是一名 freelancer。项目外包、雇佣洽谈等事项请通过邮箱和我联系。</p></div><div id=footer><nav id=article-skip><div class=next><a alt="Newer article" href=https://www.chucklin.net/post/analysesql/>&larr; Newer</a></div><div class=top><a alt="Top of page" href=#>Top</a></div><div class=prev><a alt="Older article" href=https://www.chucklin.net/post/csrf/>Older &rarr;</a></div></nav><aside id=social><div id=social-icons><div class=icon-24x24><a class=glyph alt="GitHub profile" href=https://github.com/chuck1in><img src=https://www.chucklin.net/icons/github.svg height=24px width=24px></a></div></div></aside><p class=copyright>Copyright © 2021 Chuck Lin. All rights reserved.</p></div></body></html>