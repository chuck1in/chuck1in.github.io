<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>什么是好的 Web Api 的设计 | ChuckLin's Blog</title><meta name=description content="Love and Peace"><meta name=author content><link rel=apple-touch-icon sizes=180x180 href=https://www.chucklin.net/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://www.chucklin.net/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.chucklin.net/favicon-16x16.png><link rel=manifest href=https://www.chucklin.net/site.webmanifest><link rel=mask-icon href=https://www.chucklin.net/safari-pinned-tab.svg color=#00416a><meta name=msapplication-TileColor content="#00aba9"><meta name=theme-color content="#ffffff"><link rel=me href=mailto:mikumiku.lch@hotmail.com><link rel=me href=https://github.com/chuck1in><link rel=authorization_endpoint href=https://indieauth.com/auth><link rel=token_endpoint href=https://tokens.indieauth.com/token><link rel=stylesheet href=https://www.chucklin.net/css/fonts.css><link rel=stylesheet href=https://www.chucklin.net/css/style.css><link rel=stylesheet href=https://www.chucklin.net/css/custom.css><meta name=viewport content="width=device-width,initial-scale=1"></head><body><div id=sitelogo><a class=glyph alt=Home href=https://www.chucklin.net/><img src=https://www.chucklin.net/images/site-logo.svg alt="Site Logo" height=64px width=64px></a></div><header><nav><div id=page-nav><div class=page-nav-item><a href=https://www.chucklin.net/>Home</a></div><div class=page-nav-item><a href=/about/me><span>About</span></a></div><div class=page-nav-item><a href=/tags><span>Tag</span></a></div></div></nav></header><div id=content><article class=h-entry><header><h1 class="post-title p-name">什么是好的 Web Api 的设计</h1><p class=post-date>Posted on
<time class=dt-published datetime=2020-01-17T09:23:00+08:00>17 January, 2020 at 09:23 +0800</time> by <a href=https://www.chucklin.net/ class="p-author h-card" rel=author>Chuck Lin</a></p></header><section class="content e-content"><h2 id=web-api-的重要性>Web Api 的重要性</h2><p>web api 就像一张名片一样，专业的名片可以迅速帮助你与客户之间建立信任感，也可能让你的产品在被使用前，就给客户留下业余，糟糕的负面印象。而一旦客户对你的产品产生负面情绪，这种情绪就会蔓延到产品生态圈甚至于相关公司上。</p><p>所以，优雅的 api 设计是成功的产品不可或缺的一部分。</p><p>回归主题，对后端工程师来讲，web api 的设计是每天都会接触的工作。在枯燥单调的重复性劳作中，你是否曾经认真思考过好的 web api 设计应该是什么样子的？</p><p>别担心。本篇文章围绕 web api 的设计，作者与大家分享一些 api 设计的套路与规范，让你和你的团队也能设计出优雅、健壮、扩展性强的应用程序接口。</p><h2 id=什么是优雅的-web-api>什么是优雅的 Web Api</h2><p>先让我们回顾曾经提到过的关于设计模式的内容：设计模式的精髓在于设计原则，而非模式的生搬硬套。与此类似，优雅的 Web Api 有两个重要原则、如下所示：</p><ul><li>设计规范明确的内容必须遵守相关规范</li><li>没有设计规范的内容必须遵守相关事实标准</li></ul><p>给自己一些时间，认真阅读并体会上面两个重要原则。</p><p>读完上面两个重要原则后，你现在应该依然对如何设计 web api 毫无头绪。别着急，好的创作总是从模仿开始的。</p><p>在我们开始长篇大论之前，先通过国际大厂的 web api 示例来观赏一下国际范儿的 web api 长啥样吧。</p><table><thead><tr><th>厂名</th><th>uri</th><th>备注</th></tr></thead><tbody><tr><td>Twitter</td><td>api.twitter.com/1.1</td><td>&ldquo;治国理政平台&rdquo;</td></tr><tr><td>Google Calendar</td><td><a href=http://www.googleapis.com/calendar/v3>www.googleapis.com/calendar/v3</a></td><td>&ldquo;大厂&rdquo;</td></tr><tr><td>instagram</td><td>api.instagram.com/v1/usrs/search?q=jack</td><td>&ldquo;宠物自拍网站&rdquo;</td></tr><tr><td>linkedin</td><td>api.linkedin.com/v1/people-search</td><td>&ldquo;招工&rdquo;</td></tr><tr><td>Tumblr</td><td>api.tumblr.com/v2</td><td>&ldquo;真的不是成人网站&rdquo;</td></tr><tr><td>foursquare</td><td>api.foursquare.com/v2/venues/search?q=apple&categoryId=asad123456</td><td>&ldquo;基于地理位置射交&rdquo;</td></tr></tbody></table><p>为节约篇幅举例就到此了。如果你觉得示例较少，可自行搜索其他大厂的 Api 示例。</p><p>分析这些大厂 Api 端点的设计可以揣摩总结出各种套路规范，供我们模仿学习，这是我们的第一步。</p><h2 id=如何设计出国际范儿的-api-端点>如何设计出国际范儿的 Api 端点？</h2><h3 id=背口诀>背口诀</h3><p>观察和分析上一小节中的国际大厂的设计往往都具备以下几个特点：</p><ul><li><p>短小便于输入的 URI。</p><blockquote><p>没人喜欢复杂的单词。</p></blockquote></li><li><p>人可以读懂的 URI。</p><blockquote><p>名片是拿给人读的。不要把机器码和 16 进制写到 URI 里。</p></blockquote></li><li><p>没有大小写混用的 URI。</p><blockquote><p>实际上一般的事实规范是建议全部小写。</p></blockquote></li><li><p>修改方便的 URI。</p><blockquote><p>api.sample.com/user/:id 傻子都看的出来通过变量 id 可以访问不同的用户信息。</p></blockquote></li><li><p>不会暴露服务端架构的 URI。</p><blockquote><p>api.sample.com/servlet/login.do 这样的代码傻子都知道后端是用面向环境编程的语言写的。</p></blockquote></li><li><p>规则统一的 URI。</p><blockquote><p>api.com.cn/Api/user-InfoById/info.json</p></blockquote></li><li><p>当端点里出现两个以上的单词时，使用脊柱法（连词符号）。</p><blockquote><p>api.linkedin.com/v1/people-search</p></blockquote></li></ul><p>本篇文章大部分读者都是工程师，而且很聪明。所以我认为没有必要对所有的特点进行说明。只要把以上特点都背下来然后记在脑子里，设计的第一步你就合格了。</p><h3 id=合理利用-rest-api>合理利用 REST API</h3><p>好的 WEB API 离不开的概念就是 REST API。那么优雅的 API 是不是一定要采用 REST API 来设计呢？
要理清这个问题首先要搞明白 REST 的准确含义到底是什么。</p><p>REST API 的概念首先出现在 Roy Fielding 的论文中。
狭义上的 REST API 实际上就是指符合 Fielding 的 REST 架构风格的 Web 服务系统。REST API 的设计风格严谨，考虑周全，结构优美。但过于苛刻的标准一直是狭义 REST API 推广壮大的绊脚石。</p><p>广义上的 REST API 指符合 RPC 风格的 JSON + Http 的接口的系统。这样的 REST API 定义却又过于粗犷和随意了。</p><p>于是，针对 WEB API 的发展以及广义 REST 与 狭义 REST 的特点， Martin Fowler 提出在达到完美的 REST API 之前有以下几种 API 的设计级别。</p><ul><li>REST LEVEL0: 使用 HTTP</li><li>REST LEVEL1: 引入资源的概念</li><li>REST LEVEL2: 引入 HTTP 动词</li><li>REST LEVEL3: 引入 HATEOAS 概念</li></ul><p>按照 HTTP 协议中，URI 代表资源，而 HTTP method 代表对资源的操作。
我以此理论作为基础，再参照上述 REST LEVEL，我设计了一个符合 REST LEVEL2 标准的示例 URI ，如下所示</p><table><thead><tr><th>目的</th><th>端点</th><th>方法</th></tr></thead><tbody><tr><td>获取用户信息列表</td><td>api.example.com/v1/users</td><td>GET</td></tr><tr><td>新用户注册</td><td>api.example.com/v1/users</td><td>POST</td></tr><tr><td>获取特定用户信息</td><td>api.example.com/v1/users/:id</td><td>GET</td></tr><tr><td>更新用户信息</td><td>api.example.com/v1/users/:id/</td><td>PUT/PATCH</td></tr><tr><td>删除用户信息</td><td>api.example.com/v1/users/:id</td><td>DELETE</td></tr></tbody></table><p>从今以后，你的 WEB API 只要参照以上示例设计，那就是符合基本标准，也很难被吐槽的 WEB API。</p><p>最后补充一点，虽然 REST Level3 描绘了一副美妙的蓝图。但截止本篇文章发表之前互联网上的大部分项目都只是朝向 Level2 的标准在努力，距离 LEVEL3 还有十分遥远的距离。故本篇文章就不在此展开对 LEVEL3 的讨论了。如果你有兴趣请自行参考相关资料了解。</p><h2 id=总结>总结</h2><p>本篇文章是本系列的第一个篇章。着重围绕各大厂的 API 示例与设计行业的通用理念，归纳总结了若干设计国际范儿 api 的套路与规则。熟读这些套路，遵守这些规则是你领会 web api 设计的一小步。后期的文章中我们将逐步介绍各种设计细节，完善你的网络应用程序接口。</p><hr><p>Copyright 2017/08/15 by Chuck Lin</p><p>参考书籍
《Web Api 的设计与开发》</p></section><footer><a class="permalink u-url" href=https://www.chucklin.net/post/webapi/>🔗</a><hr class=post-underline><p class=post-tag>Tags for this post:
<a href=https://www.chucklin.net/tags/java class="post-tag p-category">java</a></p></footer></article></div><div class=h-card><img class=u-photo src=https://www.chucklin.net/images/avator.jpg><div class=card-content><h2 class=card-name><a class="p-name u-url" href=https://www.chucklin.net/ rel=me>Chuck Lin</a></h2><p class=card-subhead><span class=p-locality>Chengdu</span>,
<span class=p-country-name>China</span><br><a class=u-email href=mailto:mikumiku.lch@hotmail.com>Email me</a></p></div><p class=p-note>👋很高兴见到你。我从事开发工作已10年，持续写作4年。现在的身份是一名 freelancer。项目外包，雇佣洽谈等事项请通过邮箱和我联系。</p></div><div id=footer><nav id=article-skip><div class=next><a alt="Newer article" href=https://www.chucklin.net/post/webapi2/>&larr; Newer</a></div><div class=top><a alt="Top of page" href=#>Top</a></div><div class=prev><a alt="Older article" href=https://www.chucklin.net/post/coroutine/>Older &rarr;</a></div></nav><aside id=social><div id=social-icons><div class=icon-24x24><a class=glyph alt="GitHub profile" href=https://github.com/chuck1in><img src=https://www.chucklin.net/icons/github.svg height=24px width=24px></a></div></div></aside><p class=copyright>Copyright © 2021 Chuck Lin. All rights reserved.</p></div></body></html>